<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Grades - Section A</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
        }
        
        .grade-input {
            width: 55px;
            height: 32px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .grade-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        .grade-input:hover {
            border-color: #d1d5db;
        }
        
        .component-avg {
            background: #f8fafc;
            font-weight: 600;
            color: #1e293b;
            border: 1px solid #e2e8f0;
        }
        
        .final-grade {
            background: #3b82f6;
            color: white;
            font-weight: 700;
        }
        
        .student-row:hover {
            background: #f8fafc;
        }
        
        .quarter-tab {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quarter-tab.active {
            background: #3b82f6;
            color: white;
        }
        
        .quarter-tab:not(.active) {
            background: #f1f5f9;
            color: #64748b;
        }
        
        .quarter-tab:not(.active):hover {
            background: #e2e8f0;
        }
        
        .component-header {
            background: #f8fafc;
            border-left: 3px solid #3b82f6;
            font-weight: 600;
        }
        
        .ww-header { border-left-color: #10b981; }
        .pt-header { border-left-color: #f59e0b; }
        .qa-header { border-left-color: #ef4444; }
        
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: #10b981;
            color: white;
            border-radius: 6px;
            font-size: 13px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .add-assessment {
            width: 55px;
            height: 32px;
            border: 2px dashed #d1d5db;
            border-radius: 4px;
            background: #f9fafb;
            color: #6b7280;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-assessment:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #eff6ff;
        }

        .main-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .table-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 200px);
            position: relative;
        }

        .table-header-container {
            position: sticky;
            top: 0;
            z-index: 20;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .table-header-scroll {
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .table-header-scroll::-webkit-scrollbar {
            display: none;
        }

        .table-body-container {
            flex: 1;
            overflow-x: auto;
            overflow-y: auto;
        }

        @media print {
            body {
                overflow: visible !important;
                height: auto !important;
            }
            
            .main-container {
                height: auto !important;
            }
            
            .content-area {
                overflow: visible !important;
            }
            
            .table-container {
                overflow: visible !important;
                height: auto !important;
                max-height: none !important;
            }
            
            .scroll-area {
                overflow: visible !important;
                height: auto !important;
            }
            
            .quarter-tab:not(.active) {
                display: none;
            }
            
            button {
                display: none !important;
            }
            
            .add-assessment {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="main-container">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 flex-shrink-0">
            <div class="px-8 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button onclick="history.back()" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="fas fa-arrow-left"></i>
                            <span>Back to Dashboard</span>
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <span class="text-sm font-medium text-gray-900">Prof. Maria Santos</span>
                        <button class="text-gray-500 hover:text-gray-700 text-sm">
                            <i class="fas fa-sign-out-alt mr-1"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Section Info -->
        <div class="bg-white border-b border-gray-100 flex-shrink-0">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-6">
                        <div>
                            <h1 class="text-xl font-semibold text-gray-900">Grade 4 - Section A - Science</h1>
                            <div class="flex items-center space-x-4 text-sm text-gray-500 mt-1">
                                <span>30 students</span>
                                <span>SY 2024-2025</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="bg-gray-50 rounded-lg p-1 border border-gray-200">
                            <button class="quarter-tab active" data-quarter="1">1st Quarter</button>
                            <button class="quarter-tab" data-quarter="2">2nd Quarter</button>
                            <button class="quarter-tab" data-quarter="3">3rd Quarter</button>
                            <button class="quarter-tab" data-quarter="4">4th Quarter</button>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button onclick="openSummaryModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">
                                <i class="fas fa-chart-line mr-1"></i>View Summary
                            </button>
                            <button onclick="exportGrades()" class="text-gray-600 hover:text-gray-900 text-sm">
                                <i class="fas fa-download mr-1"></i>Export
                            </button>
                            <button onclick="printGrades()" class="text-gray-600 hover:text-gray-900 text-sm">
                                <i class="fas fa-print mr-1"></i>Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="content-area p-8">
            <div class="table-container bg-white rounded-lg border border-gray-200">
                <!-- Table Header - Fixed -->
                <div class="table-header-container">
                    <div class="table-header-scroll" id="header-scroll">
                        <div class="px-8 py-4">
                            <div class="flex items-center space-x-4 min-w-max" id="table-header">
                                <!-- Header will be generated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Table Body - Scrollable -->
                <div class="table-body-container" id="body-scroll">
                    <!-- Student Rows -->
                    <div class="divide-y divide-gray-200" id="student-list">
                        <!-- Students will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Assessment Modal -->
    <div id="add-assessment-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50" onclick="closeAddAssessmentModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Add New Assessment</h3>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Assessment Name</label>
                        <input type="text" id="assessment-name" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm" placeholder="e.g., Quiz 1, Project 1">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Component</label>
                        <select id="assessment-component" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                            <option value="ww">Written Works</option>
                            <option value="pt">Performance Tasks</option>
                            <option value="qa">Quarterly Assessment</option>
                        </select>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button onclick="closeAddAssessmentModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">
                        Cancel
                    </button>
                    <button onclick="addAssessment()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                        Add Assessment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grade Summary Modal -->
    <div id="summary-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50" onclick="closeSummaryModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">Grade Summary - All Quarters</h3>
                    <button onclick="closeSummaryModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-auto max-h-[calc(90vh-120px)]">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48">Student</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">1st Quarter</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">2nd Quarter</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">3rd Quarter</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">4th Quarter</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Final Grade</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody id="summary-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Summary data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button onclick="exportSummary()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">
                        <i class="fas fa-download mr-1"></i>Export Summary
                    </button>
                    <button onclick="printSummary()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">
                        <i class="fas fa-print mr-1"></i>Print Summary
                    </button>
                    <button onclick="closeSummaryModal()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Indicator -->
    <div id="save-indicator" class="save-indicator">
        <i class="fas fa-check mr-2"></i>Saved
    </div>

    <script>
        // Students data
        const students = [
            { id: '2024-001', name: 'Maria Clara Santos' },
            { id: '2024-002', name: 'Juan Carlos Dela Cruz' },
            { id: '2024-003', name: 'Ana Marie Reyes' },
            { id: '2024-004', name: 'Miguel Angelo Torres' },
            { id: '2024-005', name: 'Sofia Isabella Garcia' },
            { id: '2024-006', name: 'Carlos Eduardo Mendoza' },
            { id: '2024-007', name: 'Patricia Anne Villanueva' },
            { id: '2024-008', name: 'Roberto Miguel Santos' },
            { id: '2024-009', name: 'Isabella Marie Cruz' },
            { id: '2024-010', name: 'Alexander John Reyes' }
        ];

        // Assessment structure
        const assessments = {
            1: {
                ww: ['Quiz 1', 'Quiz 2', 'Assignment 1'],
                pt: ['Project 1', 'Lab Activity'],
                qa: ['Final Exam']
            },
            2: {
                ww: ['Quiz 3', 'Quiz 4'],
                pt: ['Project 2'],
                qa: ['Final Exam']
            },
            3: {
                ww: [],
                pt: [],
                qa: []
            },
            4: {
                ww: [],
                pt: [],
                qa: []
            }
        };

        // Grade storage
        const grades = {};
        let currentQuarter = 1;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeGrades();
            renderInterface();
            setupEventListeners();
        });

        function initializeGrades() {
            students.forEach(student => {
                grades[student.id] = {};
                for (let quarter = 1; quarter <= 4; quarter++) {
                    grades[student.id][quarter] = {
                        ww: {},
                        pt: {},
                        qa: {}
                    };
                }
            });
            
            // Sample data
            grades['2024-001'][1].ww = { 'Quiz 1': 95, 'Quiz 2': 88, 'Assignment 1': 92 };
            grades['2024-001'][1].pt = { 'Project 1': 90, 'Lab Activity': 85 };
            grades['2024-001'][1].qa = { 'Final Exam': 88 };
            
            grades['2024-001'][2].ww = { 'Quiz 3': 92, 'Quiz 4': 85 };
            grades['2024-001'][2].pt = { 'Project 2': 88 };
            grades['2024-001'][2].qa = { 'Final Exam': 90 };
            
            // Add sample data for a few more students
            grades['2024-002'][1].ww = { 'Quiz 1': 78, 'Quiz 2': 82, 'Assignment 1': 85 };
            grades['2024-002'][1].pt = { 'Project 1': 80, 'Lab Activity': 75 };
            grades['2024-002'][1].qa = { 'Final Exam': 79 };
            
            grades['2024-002'][2].ww = { 'Quiz 3': 80, 'Quiz 4': 77 };
            grades['2024-002'][2].pt = { 'Project 2': 82 };
            grades['2024-002'][2].qa = { 'Final Exam': 81 };
            
            grades['2024-003'][1].ww = { 'Quiz 1': 90, 'Quiz 2': 94, 'Assignment 1': 88 };
            grades['2024-003'][1].pt = { 'Project 1': 92, 'Lab Activity': 89 };
            grades['2024-003'][1].qa = { 'Final Exam': 91 };
        }

        function setupEventListeners() {
            // Quarter tabs
            document.querySelectorAll('.quarter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchQuarter(parseInt(this.dataset.quarter));
                });
            });

            // Auto-save on grade input
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('grade-input')) {
                    saveGrade(e.target);
                }
            });

            // Setup scroll synchronization after interface is rendered
            setTimeout(() => {
                setupScrollSync();
            }, 100);
        }

        function setupScrollSync() {
            const headerScroll = document.getElementById('header-scroll');
            const bodyScroll = document.getElementById('body-scroll');
            
            if (headerScroll && bodyScroll) {
                // Sync header scroll with body scroll
                bodyScroll.addEventListener('scroll', function() {
                    headerScroll.scrollLeft = bodyScroll.scrollLeft;
                });
                
                // Sync body scroll with header scroll (for touch devices)
                headerScroll.addEventListener('scroll', function() {
                    bodyScroll.scrollLeft = headerScroll.scrollLeft;
                });
            }
        }

        function switchQuarter(quarter) {
            currentQuarter = quarter;
            
            // Update active tab
            document.querySelectorAll('.quarter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-quarter="${quarter}"]`).classList.add('active');
            
            renderInterface();
        }

        function renderInterface() {
            renderHeader();
            renderStudents();
            // Re-setup scroll synchronization after rendering
            setTimeout(() => {
                setupScrollSync();
            }, 50);
        }

        function renderHeader() {
            const container = document.getElementById('table-header');
            const quarterAssessments = assessments[currentQuarter];
            
            let html = '<div class="w-48 text-sm font-medium text-gray-700 flex-shrink-0">Student</div>';
            
            // Written Works
            html += '<div class="component-header ww-header px-3 py-2 text-xs font-semibold text-gray-700 w-32 flex-shrink-0">WRITTEN WORKS (30%)</div>';
            quarterAssessments.ww.forEach(assessment => {
                html += `<div class="w-14 text-center text-xs font-medium text-gray-600 flex-shrink-0">${assessment}</div>`;
            });
            html += '<button class="add-assessment flex-shrink-0" onclick="openAddAssessmentModal(\'ww\')" title="Add Written Work"><i class="fas fa-plus"></i></button>';
            html += '<div class="w-14 text-center text-xs font-semibold text-gray-700 flex-shrink-0">AVG</div>';
            
            // Performance Tasks
            html += '<div class="component-header pt-header px-3 py-2 text-xs font-semibold text-gray-700 w-32 flex-shrink-0">PERFORMANCE TASKS (50%)</div>';
            quarterAssessments.pt.forEach(assessment => {
                html += `<div class="w-14 text-center text-xs font-medium text-gray-600 flex-shrink-0">${assessment}</div>`;
            });
            html += '<button class="add-assessment flex-shrink-0" onclick="openAddAssessmentModal(\'pt\')" title="Add Performance Task"><i class="fas fa-plus"></i></button>';
            html += '<div class="w-14 text-center text-xs font-semibold text-gray-700 flex-shrink-0">AVG</div>';
            
            // Quarterly Assessment
            html += '<div class="component-header qa-header px-3 py-2 text-xs font-semibold text-gray-700 w-32 flex-shrink-0">QUARTERLY ASSESSMENT (20%)</div>';
            quarterAssessments.qa.forEach(assessment => {
                html += `<div class="w-14 text-center text-xs font-medium text-gray-600 flex-shrink-0">${assessment}</div>`;
            });
            html += '<button class="add-assessment flex-shrink-0" onclick="openAddAssessmentModal(\'qa\')" title="Add Quarterly Assessment"><i class="fas fa-plus"></i></button>';
            html += '<div class="w-14 text-center text-xs font-semibold text-gray-700 flex-shrink-0">AVG</div>';
            
            // Final Grade
            html += '<div class="w-16 text-center text-xs font-semibold text-gray-700 flex-shrink-0">FINAL</div>';
            html += '<div class="w-16 text-center text-xs font-semibold text-gray-700 flex-shrink-0">STATUS</div>';
            
            container.innerHTML = html;
        }

        function renderStudents() {
            const container = document.getElementById('student-list');
            const quarterAssessments = assessments[currentQuarter];
            let html = '';

            students.forEach(student => {
                const studentGrades = grades[student.id][currentQuarter];
                
                html += `<div class="student-row px-8 py-3">`;
                html += `<div class="flex items-center space-x-4 min-w-max">`;
                
                // Student name - matching header width
                html += `<div class="w-48 flex-shrink-0">
                    <div class="font-semibold text-gray-900 text-sm">${student.name}</div>
                    <div class="text-xs text-gray-500">${student.id}</div>
                </div>`;
                
                // Written Works
                html += '<div class="w-32 flex-shrink-0"></div>'; // spacer for header - matching component header width
                quarterAssessments.ww.forEach(assessment => {
                    const grade = studentGrades.ww[assessment] || '';
                    html += `<div class="w-14 flex-shrink-0 flex justify-center">
                        <input type="number" class="grade-input" value="${grade}" min="0" max="100" 
                               data-student="${student.id}" data-component="ww" data-assessment="${assessment}" placeholder="--">
                    </div>`;
                });
                html += '<div class="w-14 flex-shrink-0"></div>'; // spacer for add button
                const wwAvg = calculateComponentAverage(studentGrades.ww);
                html += `<div class="w-14 flex-shrink-0 flex justify-center"><div class="grade-input component-avg">${wwAvg}</div></div>`;
                
                // Performance Tasks
                html += '<div class="w-32 flex-shrink-0"></div>'; // spacer for header - matching component header width
                quarterAssessments.pt.forEach(assessment => {
                    const grade = studentGrades.pt[assessment] || '';
                    html += `<div class="w-14 flex-shrink-0 flex justify-center">
                        <input type="number" class="grade-input" value="${grade}" min="0" max="100" 
                               data-student="${student.id}" data-component="pt" data-assessment="${assessment}" placeholder="--">
                    </div>`;
                });
                html += '<div class="w-14 flex-shrink-0"></div>'; // spacer for add button
                const ptAvg = calculateComponentAverage(studentGrades.pt);
                html += `<div class="w-14 flex-shrink-0 flex justify-center"><div class="grade-input component-avg">${ptAvg}</div></div>`;
                
                // Quarterly Assessment
                html += '<div class="w-32 flex-shrink-0"></div>'; // spacer for header - matching component header width
                quarterAssessments.qa.forEach(assessment => {
                    const grade = studentGrades.qa[assessment] || '';
                    html += `<div class="w-14 flex-shrink-0 flex justify-center">
                        <input type="number" class="grade-input" value="${grade}" min="0" max="100" 
                               data-student="${student.id}" data-component="qa" data-assessment="${assessment}" placeholder="--">
                    </div>`;
                });
                html += '<div class="w-14 flex-shrink-0"></div>'; // spacer for add button
                const qaAvg = calculateComponentAverage(studentGrades.qa);
                html += `<div class="w-14 flex-shrink-0 flex justify-center"><div class="grade-input component-avg">${qaAvg}</div></div>`;
                
                // Final Grade and Status
                const finalGrade = calculateFinalGrade(wwAvg, ptAvg, qaAvg);
                const status = finalGrade >= 75 ? 'PASS' : 'FAIL';
                const statusClass = finalGrade >= 75 ? 'text-green-600' : 'text-red-600';
                
                html += `<div class="w-16 flex-shrink-0 flex justify-center"><div class="grade-input final-grade">${finalGrade}</div></div>`;
                html += `<div class="w-16 text-center text-xs font-semibold ${statusClass} flex-shrink-0">${status}</div>`;
                
                html += '</div></div>';
            });

            container.innerHTML = html;
        }

        function calculateComponentAverage(componentGrades) {
            const values = Object.values(componentGrades).filter(g => g !== null && g !== undefined && g !== '');
            if (values.length === 0) return '--';
            const sum = values.reduce((a, b) => a + parseFloat(b), 0);
            return Math.round((sum / values.length) * 10) / 10;
        }

        function calculateFinalGrade(wwAvg, ptAvg, qaAvg) {
            if (wwAvg === '--' || ptAvg === '--' || qaAvg === '--') return '--';
            const final = (wwAvg * 0.3) + (ptAvg * 0.5) + (qaAvg * 0.2);
            return Math.round(final * 10) / 10;
        }

        function saveGrade(input) {
            const studentId = input.dataset.student;
            const component = input.dataset.component;
            const assessment = input.dataset.assessment;
            const value = parseFloat(input.value) || null;
            
            grades[studentId][currentQuarter][component][assessment] = value;
            
            // Re-render to update averages and final grades
            renderStudents();
            showSaveIndicator();
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('save-indicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 1500);
        }

        function openAddAssessmentModal(component) {
            document.getElementById('assessment-component').value = component;
            document.getElementById('add-assessment-modal').classList.remove('hidden');
        }

        function closeAddAssessmentModal() {
            document.getElementById('add-assessment-modal').classList.add('hidden');
            document.getElementById('assessment-name').value = '';
        }

        function addAssessment() {
            const name = document.getElementById('assessment-name').value.trim();
            const component = document.getElementById('assessment-component').value;
            
            if (!name) return;
            
            assessments[currentQuarter][component].push(name);
            renderInterface();
            closeAddAssessmentModal();
        }

        function exportGrades() {
            // Export functionality would go here
            console.log('Exporting grades for quarter', currentQuarter);
        }

        function printGrades() {
            window.print();
        }

        // Summary Modal Functions
        function openSummaryModal() {
            generateSummaryData();
            document.getElementById('summary-modal').classList.remove('hidden');
        }

        function closeSummaryModal() {
            document.getElementById('summary-modal').classList.add('hidden');
        }

        function generateSummaryData() {
            const summaryBody = document.getElementById('summary-table-body');
            let html = '';

            students.forEach(student => {
                const studentGrades = grades[student.id];
                const quarterGrades = [];
                
                // Calculate final grade for each quarter
                for (let quarter = 1; quarter <= 4; quarter++) {
                    const wwAvg = calculateComponentAverage(studentGrades[quarter].ww);
                    const ptAvg = calculateComponentAverage(studentGrades[quarter].pt);
                    const qaAvg = calculateComponentAverage(studentGrades[quarter].qa);
                    const finalGrade = calculateFinalGrade(wwAvg, ptAvg, qaAvg);
                    quarterGrades.push(finalGrade);
                }

                // Calculate overall final grade (average of all quarters)
                const validGrades = quarterGrades.filter(grade => grade !== '--' && !isNaN(grade));
                const overallFinalGrade = validGrades.length > 0 
                    ? Math.round((validGrades.reduce((a, b) => a + b, 0) / validGrades.length) * 10) / 10
                    : '--';
                
                const overallStatus = overallFinalGrade !== '--' && overallFinalGrade >= 75 ? 'PASS' : 'FAIL';
                const statusClass = overallFinalGrade !== '--' && overallFinalGrade >= 75 ? 'text-green-600' : 'text-red-600';

                html += `<tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <div class="font-medium text-gray-900">${student.name}</div>
                        <div class="text-sm text-gray-500">${student.id}</div>
                    </td>`;

                // Quarter grades
                quarterGrades.forEach((grade, index) => {
                    const gradeClass = grade !== '--' && grade >= 75 ? 'text-green-600' : grade !== '--' ? 'text-red-600' : 'text-gray-400';
                    html += `<td class="px-4 py-3 text-center">
                        <span class="font-medium ${gradeClass}">${grade}</span>
                    </td>`;
                });

                // Overall final grade and status
                const finalGradeClass = overallFinalGrade !== '--' && overallFinalGrade >= 75 ? 'text-green-600' : overallFinalGrade !== '--' ? 'text-red-600' : 'text-gray-400';
                html += `<td class="px-4 py-3 text-center">
                    <span class="font-bold ${finalGradeClass}">${overallFinalGrade}</span>
                </td>
                <td class="px-4 py-3 text-center">
                    <span class="font-semibold ${statusClass}">${overallStatus}</span>
                </td>`;

                html += '</tr>';
            });

            summaryBody.innerHTML = html;
        }

        function exportSummary() {
            // Export summary functionality would go here
            console.log('Exporting grade summary');
        }

        function printSummary() {
            // Create a new window for printing the summary
            const printWindow = window.open('', '_blank');
            const summaryTable = document.querySelector('#summary-modal table').outerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Grade Summary - Section A Science</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .text-center { text-align: center; }
                        .text-green-600 { color: #059669; }
                        .text-red-600 { color: #dc2626; }
                        .text-gray-400 { color: #9ca3af; }
                        .font-bold { font-weight: bold; }
                        .font-medium { font-weight: 500; }
                        .font-semibold { font-weight: 600; }
                    </style>
                </head>
                <body>
                    <h1>Grade Summary - Section A Science</h1>
                    <p><strong>School Year:</strong> 2024-2025</p>
                    ${summaryTable}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
    </script>
</body>
</html>